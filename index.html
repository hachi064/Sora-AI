<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>æ—¥æœ¬èªä¼šè©±</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!--  CSS  -->
  <style> 
    body {
      font-family: sans-serif;
      padding: 1em;
      max-width: 600px;
      margin: auto;
      background-color: #f9f9f9;
    }
    input, textarea, button {
      width: 100%;
      padding: 0.75em;
      margin-top: 0.5em;
      font-size: 1em;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
    button {
      background-color: #007aff;
      color: white;
      border: none;
    }
    #res {
      margin-top: 1em;
      background: #fff;
      padding: 1em;
      border-radius: 6px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
      white-space: pre-wrap;
    }
  </style>
</head>
<body>
  <h2>ğŸ—£ï¸ SORA MAMAç”¨æ—¥æœ¬èªä¼šè©±ç·´ç¿’ãƒŸãƒ‹</h2>
  <label>ğŸ”‘Private API Key</label>
  <input type="password" id="apiKey" placeholder="sk-or-...">

  <label>ğŸ’¬ ã‚ãªãŸã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</label>
  <textarea id="msg" rows="3" placeholder="ä¾‹ï¼šã“ã®æ–‡æ³•ã®ä½¿ã„æ–¹ã‚’æ•™ãˆã¦ãã ã•ã„ã€‚"></textarea>
  <button onclick="startListening()">ğŸ¤ è©±ã™</button>
  <button onclick="chatAndSpeak()">é€ä¿¡ã™ã‚‹</button>

  <div id="res"></div>

  <script> // js - javascript
    async function chatAndSpeak() {
      const key = document.getElementById("apiKey").value.trim();
      const msg = document.getElementById("msg").value.trim();
      if (!key || !msg) {
        alert("APIã‚­ãƒ¼ã¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
        return;
      }
    
      document.getElementById("res").innerText = "â³ å¿œç­”ä¸­...";
    
      try {
        const res = await fetch("https://openrouter.ai/api/v1/chat/completions", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": "Bearer " + key
          },
          body: JSON.stringify({
            model: "openai/gpt-3.5-turbo",
            messages: [
              { role: "system", content: "ã‚ãªãŸã¯æ—¥æœ¬èªæ•™å¸«ã§ã™ã€‚" },
              { role: "user", content: msg }
            ]
          })
        });
    
        const data = await res.json();
        const responseText = data.choices?.[0]?.message?.content || "âŒ å¿œç­”ãªã—ã€‚";
        document.getElementById("res").innerText = responseText;
    
        speakText(responseText);
      } catch (err) {
        document.getElementById("res").innerText = "âŒ ã‚¨ãƒ©ãƒ¼: " + err.message;
      }
    }

    // update function listening
    function startListening() {
      const msgInput = document.getElementById("msg"); // lÆ°u giÃ¡ trá»‹ nháº­p tay
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;  // lÆ°u giÃ¡ trá»‹ mÃ  nÃ³i
      if (!SpeechRecognition) {
        alert("ã“ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯éŸ³å£°èªè­˜ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã›ã‚“ã€‚");
        return;
      }

      const recognition = new SpeechRecognition(); // táº¡o 1 cÃ¡i biáº¿n má»›i vá»›i má»—i láº§n báº¥m nÃºt voice
      recognition.lang = "ja-JP"; // ngÃ´n ngá»¯ Ä‘áº§u vÃ o lÃ  tiáº¿ng nháº­t 
      recognition.interimResults = false;
      recognition.maxAlternatives = 1;

      recognition.start();

      recognition.onresult = (event) => {
        const transcript = event.results[0][0].transcript;
        msgInput.value = transcript;
      };
      // tÃ³m láº¡i Ä‘oáº¡n 97 - 107 lÃ  báº¯t cÃ¡i mic cá»§a vá»£

      recognition.onerror = (event) => {
        alert("ğŸ¤ éŸ³å£°èªè­˜ã‚¨ãƒ©ãƒ¼: " + event.error);
      };
    }

    // Äá»c láº¡i báº±ng giá»ng nÃ³i
    function speakText(text) {
      const synth = window.speechSynthesis;
      if (!synth) {
        alert("éŸ³å£°åˆæˆãŒã“ã®ãƒ–ãƒ©ã‚¦ã‚¶ã§ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚");
        return;
      }

      function speak() {
        const voices = synth.getVoices();
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.lang = "ja-JP";

        const japaneseVoice = voices.find(v => v.lang === "ja-JP");
        if (japaneseVoice) {
          utterance.voice = japaneseVoice;
        }

        synth.speak(utterance);
      }

      if (synth.getVoices().length === 0) {
        synth.onvoiceschanged = () => speak();
      } else {
        speak();
      }
    }
  </script>
</body>
</html>
